<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Richmedia Studio - Wizard</title>
    <link rel="stylesheet" href="assets/css/style.css" />
</head>
<body>
<div class="app">
    <aside class="sidebar">
        <div class="brand">
            <div class="brand-logo"></div>
            <div>
                <div class="brand-name">Richmedia Studio</div>
                <div class="muted">建立 Richmedia Demo 精靈</div>
            </div>
        </div>
        <div id="stepper" class="stepper"></div>
    </aside>
    <main class="content">
        <div class="two-col">
            <section id="form-panel" class="panel"></section>
            <section class="panel">
                <div class="preview-title">即時預覽</div>
                <div id="global-preview" class="preview-box">
                    <div class="muted">依照您的設定將顯示預覽（素材上傳後可播放簡易動畫）</div>
                </div>
            </section>
        </div>
        <div class="nav">
            <div class="inline">
                <button id="btn-back" class="btn ghost">上一步</button>
                <span id="step-hint" class="muted"></span>
            </div>
            <div class="inline">
                <button id="btn-save" class="btn">暫存</button>
                <button id="btn-next" class="btn primary">下一步</button>
            </div>
        </div>
    </main>
</div>

<template id="tpl-stepper-item">
    <div class="step">
        <div class="step-index"></div>
        <div>
            <div class="step-title"></div>
            <div class="step-hint"></div>
        </div>
        <div></div>
    </div>
    </template>

<script>
    const state = {
        currentStep: 0,
        steps: [
            { key: 'step1', title: 'Step 1', hint: '提案/上稿、產業別、客戶名稱' },
            { key: 'step2', title: 'Step 2', hint: '是否搭配數據包與標籤條件' },
            { key: 'step3', title: 'Step 3', hint: '裝置尺寸與是否同步 DV360' },
            { key: 'step4', title: 'Step 4', hint: '版位選擇與出現順序' },
            { key: 'step5', title: 'Step 5', hint: '各版位進階設定與預覽' },
            { key: 'step6', title: 'Step 6', hint: 'API 條件觸發與進階設定' },
            { key: 'step7', title: 'Step 7', hint: '匯出方式與輸出' },
        ],
        form: {
            step1: { type: '', industry: '', client: '' },
            step2: { withDataPack: '否', tags: '' },
            step3: { device: '', withDV360: '否' },
            step4: { placements: [], order: [] },
            step5: {
                cover: { needLead: '否', leadSeconds: '', frames: 0, leadImages: [], playVideo: '否', videoFile: null, needHold: '否', holdImage: null },
                bottom: { mode: '', template: '', assets: [] },
                inline: { mode: '', template: '', assets: [] }
            },
            step6: { triggers: [], settings: {} },
            step7: { export: [] },
        }
    };

    const industries = [
        '電商', '汽車', '3C/家電', '金融', '旅遊/飯店', '美妝保養', '餐飲', '日用品', '教育', '醫療保健', '娛樂/媒體', '房地產'
    ];

    const deviceSizes = ['手機', '平板', 'PC'];
    const placements = ['蓋版', '置底', '文中'];
    const coverLeadSeconds = ['3秒', '4秒', '5秒', '6秒', '8秒', '10秒'];
    const bottomTemplates = ['置底版型A','置底版型B','置底版型C','置底版型D','置底版型E','置底版型F','置底版型G','置底版型H','置底版型I'];
    const inlineTemplates = ['文中版型A','文中版型B','文中版型C','文中版型D','文中版型E','文中版型F','文中版型G','文中版型H','文中版型I'];
    const apiOptions = ['地圖','中原標準時間','溫度','溼度','下雨機率','紫外線指數','空氣品質'];

    function renderStepper() {
        const wrap = document.getElementById('stepper');
        wrap.innerHTML = '';
        state.steps.forEach((s, i) => {
            const div = document.createElement('div');
            div.className = 'step' + (i === state.currentStep ? ' active' : '') + (i < state.currentStep ? ' completed' : '');
            const idx = document.createElement('div');
            idx.className = 'step-index';
            idx.textContent = i + 1;
            const titleWrap = document.createElement('div');
            const t = document.createElement('div'); t.className = 'step-title'; t.textContent = s.title;
            const h = document.createElement('div'); h.className = 'step-hint'; h.textContent = s.hint;
            titleWrap.appendChild(t); titleWrap.appendChild(h);
            div.appendChild(idx); div.appendChild(titleWrap); div.appendChild(document.createElement('div'));
            div.addEventListener('click', () => { state.currentStep = i; tick(); });
            wrap.appendChild(div);
        });
    }

    function setHint(text) {
        document.getElementById('step-hint').textContent = text || '';
    }

    function tick() {
        renderStepper();
        renderStep();
        document.getElementById('btn-back').disabled = state.currentStep === 0;
        document.getElementById('btn-next').textContent = state.currentStep === state.steps.length - 1 ? '完成' : '下一步';
        setHint(state.steps[state.currentStep].hint);
    }

    function renderStep() {
        const host = document.getElementById('form-panel');
        host.innerHTML = '';
        const stepKey = state.steps[state.currentStep].key;
        const map = {
            step1: renderStep1,
            step2: renderStep2,
            step3: renderStep3,
            step4: renderStep4,
            step5: renderStep5,
            step6: renderStep6,
            step7: renderStep7,
        };
        map[stepKey](host);
    }

    function createField(labelText, inputEl, hint) {
        const field = document.createElement('div'); field.className = 'field';
        const l = document.createElement('label'); l.textContent = labelText; field.appendChild(l);
        field.appendChild(inputEl);
        if (hint) { const m = document.createElement('div'); m.className = 'muted'; m.textContent = hint; field.appendChild(m); }
        return field;
    }

    // Step 1
    function renderStep1(host) {
        const wrap = document.createElement('div');
        wrap.innerHTML = '<h3>Step 1｜基本資訊</h3>';
        const row = document.createElement('div'); row.className = 'row';

        // 提案/上稿
        const typeSelect = document.createElement('select');
        ;['', '提案', '上稿'].forEach(v=>{ const o = document.createElement('option'); o.value=v; o.textContent=v||'請選擇'; typeSelect.appendChild(o); });
        typeSelect.value = state.form.step1.type;
        typeSelect.addEventListener('change', e=> state.form.step1.type = e.target.value);

        // 產業別
        const industrySel = document.createElement('select');
        const d0 = document.createElement('option'); d0.value=''; d0.textContent='請選擇產業別'; industrySel.appendChild(d0);
        industries.forEach(v=>{ const o = document.createElement('option'); o.value=v; o.textContent=v; industrySel.appendChild(o); });
        industrySel.value = state.form.step1.industry;
        industrySel.addEventListener('change', e=> state.form.step1.industry = e.target.value);

        // 客戶名稱
        const clientInput = document.createElement('input'); clientInput.type='text'; clientInput.placeholder='輸入客戶名稱'; clientInput.value = state.form.step1.client; clientInput.addEventListener('input', e=> state.form.step1.client = e.target.value);

        row.appendChild(createField('用途', typeSelect));
        row.appendChild(createField('產業別', industrySel));
        const row2 = document.createElement('div'); row2.className = 'row';
        row2.appendChild(createField('客戶名稱', clientInput));

        wrap.appendChild(row);
        wrap.appendChild(row2);
        host.appendChild(wrap);
    }

    // Step 2
    function renderStep2(host) {
        const wrap = document.createElement('div');
        wrap.innerHTML = '<h3>Step 2｜數據包</h3>';

        const toggle = document.createElement('div'); toggle.className = 'inline';
        const sel = document.createElement('select'); ['否','是'].forEach(v=>{ const o=document.createElement('option'); o.value=v; o.textContent=v; sel.appendChild(o); });
        sel.value = state.form.step2.withDataPack; sel.addEventListener('change', e=>{ state.form.step2.withDataPack = e.target.value; renderStep(); });
        toggle.appendChild(createField('是否搭配數據包', sel));
        wrap.appendChild(toggle);

        const adv = document.createElement('div');
        if (state.form.step2.withDataPack === '是') {
            const ta = document.createElement('textarea'); ta.rows=3; ta.placeholder='輸入數據包標籤條件（例：性別=女；年齡=25-44；興趣=旅遊）'; ta.value = state.form.step2.tags; ta.addEventListener('input', e=> state.form.step2.tags = e.target.value);
            adv.appendChild(createField('標籤條件', ta, '使用分號分隔條件。'));        
        } else {
            const info = document.createElement('div'); info.className='muted'; info.textContent='未使用數據包，將直接進入下一步。'; adv.appendChild(info);
        }
        wrap.appendChild(adv);
        host.appendChild(wrap);
    }

    // Step 3
    function renderStep3(host) {
        const wrap = document.createElement('div');
        wrap.innerHTML = '<h3>Step 3｜裝置尺寸與 DV360</h3>';

        const row = document.createElement('div'); row.className='row';
        const devSel = document.createElement('select');
        const d0 = document.createElement('option'); d0.value=''; d0.textContent='請選擇裝置'; devSel.appendChild(d0);
        deviceSizes.forEach(v=>{ const o=document.createElement('option'); o.value=v; o.textContent=v; devSel.appendChild(o); });
        devSel.value = state.form.step3.device; devSel.addEventListener('change', e=> state.form.step3.device = e.target.value);

        const dvSel = document.createElement('select'); ['否','是'].forEach(v=>{ const o=document.createElement('option'); o.value=v; o.textContent=v; dvSel.appendChild(o); });
        dvSel.value = state.form.step3.withDV360; dvSel.addEventListener('change', e=> state.form.step3.withDV360 = e.target.value);

        row.appendChild(createField('裝置尺寸', devSel));
        row.appendChild(createField('是否需要同步製作 DV360', dvSel));
        wrap.appendChild(row);
        host.appendChild(wrap);
    }

    // Step 4
    function renderStep4(host) {
        const wrap = document.createElement('div');
        wrap.innerHTML = '<h3>Step 4｜版位選擇與順序</h3>';
        const chips = document.createElement('div'); chips.className='chips';
        const orderBar = document.createElement('div'); orderBar.className='order-bar';

        function togglePlacement(name) {
            const exists = state.form.step4.placements.includes(name);
            if (exists) {
                state.form.step4.placements = state.form.step4.placements.filter(p=>p!==name);
                state.form.step4.order = state.form.step4.order.filter(p=>p!==name);
            } else {
                state.form.step4.placements.push(name);
                state.form.step4.order.push(name);
            }
            renderStep();
        }

        placements.forEach(p=>{
            const c = document.createElement('div'); c.className = 'chip' + (state.form.step4.placements.includes(p) ? ' active' : ''); c.textContent = p; c.addEventListener('click', ()=> togglePlacement(p)); chips.appendChild(c);
        });

        wrap.appendChild(createField('選擇版位（可複選）', chips, '以點選順序作為出現順序。'));

        if (state.form.step4.order.length) {
            state.form.step4.order.forEach((name, idx)=>{
                const item = document.createElement('div'); item.className='order-item';
                const badge = document.createElement('span'); badge.className='idx'; badge.textContent = idx+1;
                const label = document.createElement('span'); label.textContent = name;
                item.appendChild(badge); item.appendChild(label);
                orderBar.appendChild(item);
            });
            const reset = document.createElement('span'); reset.className='order-reset'; reset.textContent='重置順序'; reset.addEventListener('click', ()=>{ state.form.step4.order = [...state.form.step4.placements]; renderStep(); });
            wrap.appendChild(orderBar);
            wrap.appendChild(reset);
        }

        host.appendChild(wrap);
    }

    // Step 5
    function renderStep5(host) {
        const wrap = document.createElement('div');
        wrap.innerHTML = '<h3>Step 5｜進階設定與預覽</h3>';
        if (!state.form.step4.order.length) {
            wrap.appendChild((()=>{ const d=document.createElement('div'); d.className='muted'; d.textContent='請先在 Step 4 選擇至少一個版位。'; return d; })());
            host.appendChild(wrap); return;
        }
        state.form.step4.order.forEach(name=>{
            if (name === '蓋版') wrap.appendChild(renderCoverSettings());
            if (name === '置底') wrap.appendChild(renderBottomSettings());
            if (name === '文中') wrap.appendChild(renderInlineSettings());
        });
        host.appendChild(wrap);
    }

    function renderCoverSettings() {
        const box = document.createElement('div'); box.className='panel';
        const title = document.createElement('h3'); title.textContent='蓋版｜前導特效 / 影片 / 停留畫面'; box.appendChild(title);

        // 是否需要前導特效
        const leadSel = document.createElement('select'); ['否','是'].forEach(v=>{ const o=document.createElement('option'); o.value=v; o.textContent=v; leadSel.appendChild(o); });
        leadSel.value = state.form.step5.cover.needLead; leadSel.addEventListener('change', e=>{ state.form.step5.cover.needLead = e.target.value; renderStep(); });
        box.appendChild(createField('是否需要前導特效', leadSel));

        if (state.form.step5.cover.needLead === '是') {
            const secSel = document.createElement('select');
            const ph = document.createElement('option'); ph.value=''; ph.textContent='選擇秒數'; secSel.appendChild(ph);
            coverLeadSeconds.forEach(v=>{ const o=document.createElement('option'); o.value=v; o.textContent=v; secSel.appendChild(o); });
            secSel.value = state.form.step5.cover.leadSeconds; secSel.addEventListener('change', e=>{ state.form.step5.cover.leadSeconds = e.target.value; updateFramesNeeded(); });
            box.appendChild(createField('前導特效秒數', secSel));

            const framesInfo = document.createElement('div'); framesInfo.className='muted';
            function updateFramesNeeded() {
                const s = parseInt((state.form.step5.cover.leadSeconds||'').replace('秒','')) || 0;
                // 假設 10 FPS，frames = 秒數 * 10
                const frames = s * 10; state.form.step5.cover.frames = frames;
                framesInfo.textContent = s ? `請上傳約 ${frames} 張 frames（10 FPS 估算）` : '請先選擇秒數以取得建議 frames 數量';
            }
            updateFramesNeeded();
            box.appendChild(framesInfo);

            const files = document.createElement('input'); files.type='file'; files.multiple=true; files.accept='image/*'; files.addEventListener('change', e=>{
                state.form.step5.cover.leadImages = Array.from(e.target.files||[]);
            });
            box.appendChild(createField('上傳前導特效圖片序列', files));
        }

        // 是否播放影片
        const videoSel = document.createElement('select'); ['否','是'].forEach(v=>{ const o=document.createElement('option'); o.value=v; o.textContent=v; videoSel.appendChild(o); });
        videoSel.value = state.form.step5.cover.playVideo; videoSel.addEventListener('change', e=>{ state.form.step5.cover.playVideo = e.target.value; renderStep(); });
        box.appendChild(createField('是否播放影片', videoSel));

        if (state.form.step5.cover.playVideo === '是') {
            const v = document.createElement('input'); v.type='file'; v.accept='video/*'; v.addEventListener('change', e=>{ state.form.step5.cover.videoFile = (e.target.files||[])[0] || null; });
            box.appendChild(createField('上傳影片檔', v));
        }

        // 是否需要停留畫面
        const holdSel = document.createElement('select'); ['否','是'].forEach(v=>{ const o=document.createElement('option'); o.value=v; o.textContent=v; holdSel.appendChild(o); });
        holdSel.value = state.form.step5.cover.needHold; holdSel.addEventListener('change', e=>{ state.form.step5.cover.needHold = e.target.value; renderStep(); });
        box.appendChild(createField('是否需要停留畫面', holdSel));

        if (state.form.step5.cover.needHold === '是') {
            const img = document.createElement('input'); img.type='file'; img.accept='image/*'; img.addEventListener('change', e=>{ state.form.step5.cover.holdImage = (e.target.files||[])[0] || null; });
            box.appendChild(createField('上傳停留畫面圖片', img));
        }

        const prev = document.createElement('div'); prev.className='preview-box'; prev.innerHTML = '<div class="muted">預覽：依序展示前導特效 → 影片 → 停留畫面</div>';
        box.appendChild(prev);
        return box;
    }

    function renderBottomSettings() {
        const box = document.createElement('div'); box.className='panel';
        const title = document.createElement('h3'); title.textContent='置底｜版型選擇與素材上傳'; box.appendChild(title);

        const modeSel = document.createElement('select'); ['','系統建議版型','自選版型'].forEach(v=>{ const o=document.createElement('option'); o.value=v; o.textContent=v||'請選擇'; modeSel.appendChild(o); });
        modeSel.value = state.form.step5.bottom.mode; modeSel.addEventListener('change', e=>{ state.form.step5.bottom.mode = e.target.value; state.form.step5.bottom.template=''; state.form.step5.bottom.assets=[]; renderStep(); });
        box.appendChild(createField('模式', modeSel, '選擇系統建議或自選版型。'));

        if (state.form.step5.bottom.mode === '自選版型') {
            const grid = document.createElement('div'); grid.className='grid-tiles';
            bottomTemplates.forEach(t=>{
                const tile = document.createElement('div'); tile.className='tile' + (state.form.step5.bottom.template===t?' active':'');
                const ph = document.createElement('div'); ph.className='preview';
                const name = document.createElement('h4'); name.textContent=t;
                tile.appendChild(ph); tile.appendChild(name);
                tile.addEventListener('click', ()=>{ state.form.step5.bottom.template = t; state.form.step5.bottom.assets = []; renderStep(); });
                grid.appendChild(tile);
            });
            box.appendChild(createField('選擇置底版型', grid));

            if (state.form.step5.bottom.template) {
                // Demo 規格：假設每個版型需要 2 個素材
                const up = document.createElement('input'); up.type='file'; up.multiple=true; up.accept='image/*,video/*';
                up.addEventListener('change', e=>{ state.form.step5.bottom.assets = Array.from(e.target.files||[]); });
                box.appendChild(createField('上傳素材（示意：需 2 件）', up));

                const prev = document.createElement('div'); prev.className='preview-box';
                prev.innerHTML = `<div class="muted">預覽：${state.form.step5.bottom.template} 套用素材後之動態示意</div>`;
                box.appendChild(prev);
            }
        } else if (state.form.step5.bottom.mode === '系統建議版型') {
            const info = document.createElement('div'); info.className='muted'; info.textContent='將由系統提供建議版型（此版本僅預留按鈕）。';
            box.appendChild(info);
        }
        return box;
    }

    function renderInlineSettings() {
        const box = document.createElement('div'); box.className='panel';
        const title = document.createElement('h3'); title.textContent='文中｜版型選擇與素材上傳'; box.appendChild(title);

        const modeSel = document.createElement('select'); ['','系統建議版型','自選版型'].forEach(v=>{ const o=document.createElement('option'); o.value=v; o.textContent=v||'請選擇'; modeSel.appendChild(o); });
        modeSel.value = state.form.step5.inline.mode; modeSel.addEventListener('change', e=>{ state.form.step5.inline.mode = e.target.value; state.form.step5.inline.template=''; state.form.step5.inline.assets=[]; renderStep(); });
        box.appendChild(createField('模式', modeSel));

        if (state.form.step5.inline.mode === '自選版型') {
            const grid = document.createElement('div'); grid.className='grid-tiles';
            inlineTemplates.forEach(t=>{
                const tile = document.createElement('div'); tile.className='tile' + (state.form.step5.inline.template===t?' active':'');
                const ph = document.createElement('div'); ph.className='preview';
                const name = document.createElement('h4'); name.textContent=t;
                tile.appendChild(ph); tile.appendChild(name);
                tile.addEventListener('click', ()=>{ state.form.step5.inline.template = t; state.form.step5.inline.assets = []; renderStep(); });
                grid.appendChild(tile);
            });
            box.appendChild(createField('選擇文中版型', grid));

            if (state.form.step5.inline.template) {
                // Demo 規格：假設每個版型需要 2 個素材
                const up = document.createElement('input'); up.type='file'; up.multiple=true; up.accept='image/*,video/*';
                up.addEventListener('change', e=>{ state.form.step5.inline.assets = Array.from(e.target.files||[]); });
                box.appendChild(createField('上傳素材（示意：需 2 件）', up));

                const prev = document.createElement('div'); prev.className='preview-box';
                prev.innerHTML = `<div class="muted">預覽：${state.form.step5.inline.template} 套用素材後之動態示意</div>`;
                box.appendChild(prev);
            }
        } else if (state.form.step5.inline.mode === '系統建議版型') {
            const info = document.createElement('div'); info.className='muted'; info.textContent='將由系統提供建議版型（此版本僅預留按鈕）。';
            box.appendChild(info);
        }
        return box;
    }

    // Step 6
    function renderStep6(host) {
        const wrap = document.createElement('div');
        wrap.innerHTML = '<h3>Step 6｜API 條件觸發</h3>';

        const chips = document.createElement('div'); chips.className='chips';
        function toggle(name){
            const on = state.form.step6.triggers.includes(name);
            if (on) state.form.step6.triggers = state.form.step6.triggers.filter(v=>v!==name);
            else state.form.step6.triggers.push(name);
            renderStep();
        }
        apiOptions.forEach(n=>{
            const c = document.createElement('div'); c.className='chip' + (state.form.step6.triggers.includes(n)?' active':''); c.textContent=n; c.addEventListener('click', ()=> toggle(n)); chips.appendChild(c);
        });
        wrap.appendChild(createField('選擇觸發條件（可複選）', chips));

        // 進階設定
        const adv = document.createElement('div');
        state.form.step6.triggers.forEach(n=>{
            if (n==='地圖') {
                const f = document.createElement('input'); f.type='text'; f.placeholder='輸入地區（例：台北市/信義區）'; f.value = state.form.step6.settings.geo||''; f.addEventListener('input', e=>{ state.form.step6.settings.geo = e.target.value; });
                adv.appendChild(createField('地圖｜地區', f));
            }
            if (n==='中原標準時間') {
                const f = document.createElement('input'); f.type='text'; f.placeholder='HH:mm 範圍，例：08:00-18:00'; f.value = state.form.step6.settings.time||''; f.addEventListener('input', e=>{ state.form.step6.settings.time = e.target.value; });
                adv.appendChild(createField('中原標準時間｜時段', f));
            }
            if (n==='溫度') {
                const f = document.createElement('input'); f.type='text'; f.placeholder='溫度區間（°C），例：18-28'; f.value = state.form.step6.settings.temp||''; f.addEventListener('input', e=>{ state.form.step6.settings.temp = e.target.value; });
                adv.appendChild(createField('溫度｜範圍', f));
            }
            if (n==='溼度') {
                const f = document.createElement('input'); f.type='text'; f.placeholder='相對溼度 % 區間，例：40-70'; f.value = state.form.step6.settings.hum||''; f.addEventListener('input', e=>{ state.form.step6.settings.hum = e.target.value; });
                adv.appendChild(createField('溼度｜範圍', f));
            }
            if (n==='下雨機率') {
                const f = document.createElement('input'); f.type='text'; f.placeholder='降雨機率 % 區間，例：30-80'; f.value = state.form.step6.settings.rain||''; f.addEventListener('input', e=>{ state.form.step6.settings.rain = e.target.value; });
                adv.appendChild(createField('下雨機率｜範圍', f));
            }
            if (n==='紫外線指數') {
                const f = document.createElement('input'); f.type='text'; f.placeholder='UVI 區間，例：3-7'; f.value = state.form.step6.settings.uvi||''; f.addEventListener('input', e=>{ state.form.step6.settings.uvi = e.target.value; });
                adv.appendChild(createField('紫外線指數｜範圍', f));
            }
            if (n==='空氣品質') {
                const f = document.createElement('input'); f.type='text'; f.placeholder='AQI 區間，例：0-50'; f.value = state.form.step6.settings.aqi||''; f.addEventListener('input', e=>{ state.form.step6.settings.aqi = e.target.value; });
                adv.appendChild(createField('空氣品質｜範圍', f));
            }
        });
        wrap.appendChild(adv);

        host.appendChild(wrap);
    }

    // Step 7
    function renderStep7(host) {
        const wrap = document.createElement('div');
        wrap.innerHTML = '<h3>Step 7｜匯出</h3>';
        const options = ['下載html壓縮包', 'url連結', 'QR code'];
        const chips = document.createElement('div'); chips.className='chips';
        function toggle(name){
            const on = state.form.step7.export.includes(name);
            if (on) state.form.step7.export = state.form.step7.export.filter(v=>v!==name);
            else state.form.step7.export.push(name);
            renderStep();
        }
        options.forEach(n=>{
            const c = document.createElement('div'); c.className='chip' + (state.form.step7.export.includes(n)?' active':''); c.textContent=n; c.addEventListener('click', ()=> toggle(n)); chips.appendChild(c);
        });
        wrap.appendChild(createField('選擇匯出方式（可複選）', chips));

        const out = document.createElement('div'); out.className='preview-box';
        out.innerHTML = '<div class="muted">完成後將依選擇提供對應輸出：檔案下載、可分享 URL、或 QR 圖碼。</div>';
        wrap.appendChild(out);
        host.appendChild(wrap);
    }

    // Nav actions
    document.getElementById('btn-back').addEventListener('click', ()=>{ if (state.currentStep>0){ state.currentStep--; tick(); }});
    document.getElementById('btn-next').addEventListener('click', ()=>{
        if (state.currentStep < state.steps.length - 1) {
            state.currentStep++;
            tick();
        } else {
            // 完成
            alert('設定完成！可前往匯出或下載。');
        }
    });
    document.getElementById('btn-save').addEventListener('click', ()=>{
        try {
            localStorage.setItem('richmedia-studio-state', JSON.stringify(state.form));
            alert('已暫存');
        } catch(e) { alert('暫存失敗'); }
    });

    // Restore if exists
    (function restore(){
        try {
            const raw = localStorage.getItem('richmedia-studio-state');
            if (raw) {
                const f = JSON.parse(raw);
                state.form = Object.assign({}, state.form, f);
            }
        } catch(e){}
    })();

    // kick
    tick();
</script>
<script src="assets/js/app.js"></script>
<script src="assets/js/app.js"></script>
</body>
</html>


